{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Production-safe static asset URLs for storefront product and marketing images",
  "requirements": [
    {
      "id": "REQ-80",
      "summary": "Make product image URL generation base-path aware (IC canister paths + all SPA routes) and safely handle filenames with spaces so product images load on Home/Shop/Category/Product Detail without placeholders when files exist.",
      "acceptanceCriteria": [
        "For product id \"cmf-earbuds\", the primary image and thumbnails render on the Product Detail page without showing the placeholder when the files exist.",
        "On Shop, Category, and Home featured product cards, the CMF earbuds product card shows the primary image (not the placeholder) when the image files exist.",
        "Image URLs remain valid when filenames contain spaces (e.g., \"cmf 1-2.webp\", \"cmf front.jpeg\").",
        "The generated image URLs do not incorrectly prefix route segments (e.g., no \"/product/assets/...\"), and do not rely on absolute \"/assets/...\" root paths when deployed under a canister path."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/publicAssetUrl.ts",
          "operation": "create",
          "description": "Create a small utility that generates production-safe URLs for files in frontend/public by combining a robust base-path resolver (prefer import.meta.env.BASE_URL when non-root; otherwise infer an IC canister prefix from window.location.pathname when present) with safe per-segment encoding for filenames (so spaces like \"cmf front.jpeg\" resolve). The utility must avoid relative URLs that get prefixed by the current route. (Verify the component's usage instructions before implementing.)"
        },
        {
          "path": "frontend/src/utils/productImages.ts",
          "operation": "modify",
          "description": "Refactor product image URL building to use the new public-asset URL utility, ensuring URLs remain valid across all routes and under IC canister base paths, and that only the filename (or path segments) are encoded to support spaces/special characters without breaking folder paths. (Verify the component's usage instructions before implementing.)"
        },
        {
          "path": "frontend/src/components/products/ProductCard.tsx",
          "operation": "modify",
          "description": "Ensure the product card continues to consume getProductImages outputs without creating any route-relative src values; keep existing fallback behavior and confirm it shows the real CMF earbuds image (not the placeholder) when the mapped files exist. (Verify the component's usage instructions before implementing.)"
        },
        {
          "path": "frontend/src/components/products/ProductImageGallery.tsx",
          "operation": "modify",
          "description": "Ensure the gallery uses the updated getProductImages URLs for both primary image and thumbnails so the CMF earbuds images render correctly (including filenames with spaces) and do not fail due to route-prefixed paths. (Verify the component's usage instructions before implementing.)"
        }
      ]
    },
    {
      "id": "REQ-81",
      "summary": "Update Home hero and category tile images to use the same production-safe base-path URL approach (no hardcoded absolute /assets/... paths) so generated images load under IC deployments.",
      "acceptanceCriteria": [
        "Home page hero image loads correctly in both local development and Internet Computer deployments.",
        "Electronics and Home Decor category tile images load correctly in both local development and Internet Computer deployments.",
        "No user-facing error text is introduced; any existing fallback/error text remains in plain English."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/HomePage.tsx",
          "operation": "modify",
          "description": "Replace hardcoded generated image src values with URLs produced via the same base-path-safe public asset URL utility so these files resolve correctly in local dev and IC canister-path deployments. Wire the following exact assets through the utility: frontend/public/assets/generated/the-lens-hero.dim_1600x600.png, frontend/public/assets/generated/the-lens-category-electronics.dim_800x800.png, frontend/public/assets/generated/the-lens-category-home-decor.dim_800x800.png. (Verify the component's usage instructions before implementing.)"
        },
        {
          "path": "frontend/src/utils/publicAssetUrl.ts",
          "operation": "modify",
          "description": "Add/confirm a convenience helper for generated images (e.g., taking a relative path under assets/generated) so HomePage can reference generated images consistently with product assets and without introducing route-relative URLs. (Verify the component's usage instructions before implementing.)"
        }
      ]
    },
    {
      "id": "REQ-82",
      "summary": "Ensure the CMF earbuds static image assets exist at the exact expected public paths (including spaces/casing) and will be included in the deployed frontend build output.",
      "acceptanceCriteria": [
        "The following files exist under `frontend/public/assets/products/cmf-cc-earbuds/` with exact filenames (including spaces and casing): `cmf front.jpeg`, `cmf 1-2.webp`, `cmf 2-1.webp`, `cmf 7-1.webp`, `cmf 1-1.webp`, `cmf 6-1.webp`.",
        "The deployed frontend serves these files at the exact URLs produced by the appâ€™s URL generation logic (no 404s for the mapped CMF earbuds images).",
        "If any file is missing or misnamed, it is added/corrected without changing the filenames referenced in code as a workaround."
      ],
      "file_operations": [
        {
          "path": "frontend/public/assets/products/cmf-cc-earbuds/cmf front.jpeg",
          "operation": "create",
          "description": "Add the CMF earbuds primary image file to the exact public folder path with the exact filename (including the space and casing) so it is emitted in the deployed build output and fetchable by the browser."
        },
        {
          "path": "frontend/public/assets/products/cmf-cc-earbuds/cmf 1-2.webp",
          "operation": "create",
          "description": "Add the CMF earbuds image file to the exact public folder path with the exact filename (including spaces/casing) so it is emitted in the deployed build output and fetchable by the browser."
        },
        {
          "path": "frontend/public/assets/products/cmf-cc-earbuds/cmf 2-1.webp",
          "operation": "create",
          "description": "Add the CMF earbuds image file to the exact public folder path with the exact filename (including spaces/casing) so it is emitted in the deployed build output and fetchable by the browser."
        },
        {
          "path": "frontend/public/assets/products/cmf-cc-earbuds/cmf 7-1.webp",
          "operation": "create",
          "description": "Add the CMF earbuds image file to the exact public folder path with the exact filename (including spaces/casing) so it is emitted in the deployed build output and fetchable by the browser."
        },
        {
          "path": "frontend/public/assets/products/cmf-cc-earbuds/cmf 1-1.webp",
          "operation": "create",
          "description": "Add the CMF earbuds image file to the exact public folder path with the exact filename (including spaces/casing) so it is emitted in the deployed build output and fetchable by the browser."
        },
        {
          "path": "frontend/public/assets/products/cmf-cc-earbuds/cmf 6-1.webp",
          "operation": "create",
          "description": "Add the CMF earbuds image file to the exact public folder path with the exact filename (including spaces/casing) so it is emitted in the deployed build output and fetchable by the browser."
        }
      ]
    }
  ]
}